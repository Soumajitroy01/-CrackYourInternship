class Solution {
public:
    map<int,vector<pair<int,int>>> graph;
    void traverse(TreeNode *root, int i, int j)
    {
        if(!root) return;
        
        graph[j].push_back({i, (root->val)});
        traverse(root->left, i+1, j-1);
        traverse(root->right, i+1, j+1);
    }
    vector<vector<int>> verticalTraversal(TreeNode* root) {
        vector<vector<int>> res;
        
        traverse(root,0,0);
        
        for(auto x:graph)
        {
            map<int,multiset<int>>mp;
            for(auto y:x.second)
                mp[y.first].insert(y.second);
            vector<int>v;
            for(auto y:mp)
            {
                for(auto z:y.second)
                    v.push_back(z);
            }
            res.push_back(v);
        }
        
        graph.clear();
        return res;
    }
};
